<app-spinner-and-error-container [loading]="isLoading" [error]="isError" [errorMessage]="errorMessage"></app-spinner-and-error-container>
<div class="results-page" *ngIf="!isLoading && !isError">
    <div class="page-row results-header-row">
        <div class="page-row-content" *ngIf="!showOldVersion">
            <h1 class="heading-text">Here's some recommendations...</h1>
        </div>
        <div class="page-row-content" *ngIf="showOldVersion">
            <h1 class="heading-text">Now build your plan</h1>
            <div class="header-data-cards">
                <app-data-card
                        heading="Your estimated monthly bills are"
                        [value]="'Â£' + energyCalculations.currentMonthlyBillPoundsRounded"
                        [isVerticalAtMobile]="true"
                ></app-data-card>
            </div>
        </div>
    </div>
    <div class="page-row recommendations">
        <div class="page-row-content">
            <form class="row" *ngIf="!showOldVersion">
                <div class="tab-field">
                    <input type="radio" name="tab" class="tab" id="quick-wins-radio" (click)="setTabOpened('quick-wins')" checked> <label for="quick-wins-radio">Quick Wins</label>
                    <input type="radio" name="tab" class="tab" id="financial-assistance-radio" (click)="setTabOpened('financial-assistance')"><label for="financial-assistance-radio">Financial Assistance</label>
                    <input type="radio" name="tab" class="tab" id="larger-improvements-radio" (click)="setTabOpened('larger-improvements')"><label for="larger-improvements-radio">Larger Improvements</label>
                </div>
                <div class="dismiss" *ngIf="getDismissed().length > 0">
                    <input type="radio" name="tab" class="dismiss-input" id="dismiss" (click)="setTabOpened('dismiss')"><label class="dismiss-label" for="dismiss">Dismissed ({{getDismissed().length}})</label>
                </div>
            </form>
            <div class="recommendation-cards" *ngIf="!showOldVersion">
                <div *ngIf="tabOpened === 'quick-wins'">
                    <app-energy-efficiency-recommendation-quick-win-card
                            *ngFor="let recommendation of getUserRecommendations('quick-wins'); let i = index"
                            [stepIndex]="i"
                            [recommendation]="recommendation"
                            [showMonthlySavings]="showMonthlySavings"
                            [showAddToPlanColumn]="!showDefaultRecommendation && !showDefaultRentalMeasures"
                    ></app-energy-efficiency-recommendation-quick-win-card>
                </div>
                <div *ngIf="tabOpened === 'financial-assistance'">
                    <div class="national-grants">
                        <div *ngFor="let recommendation of getUserRecommendations('financial-assistance'); let i = index">
                            <div *ngIf="recommendation.grant">
                                <app-energy-efficiency-recommendation-financial-assistance-card
                                        [stepIndex]="i"
                                        [recommendation]="recommendation"
                                        [showMonthlySavings]="showMonthlySavings"
                                        [showAddToPlanColumn]="!showDefaultRecommendation && !showDefaultRentalMeasures"
                                ></app-energy-efficiency-recommendation-financial-assistance-card>
                            </div>
                        </div>
                    </div>
                    <div class="local-authority-grants page-row" *ngIf="localAuthorityGrants && localAuthorityGrants.length > 0">
                        <div class="grant-cards">
                            <app-local-grant-card class="grant-card"
                                                  *ngFor="let grant of localAuthorityGrants"
                                                  [grant]="grant"
                                                  theme="grey">
                            </app-local-grant-card>
                        </div>
                    </div>
                </div>
                <div *ngIf="tabOpened === 'larger-improvements'">
                    <app-energy-efficiency-recommendation-larger-improvement-card
                            *ngFor="let recommendation of getUserRecommendations('larger-improvements'); let i = index"
                            [stepIndex]="i"
                            [recommendation]="recommendation"
                            [showMonthlySavings]="showMonthlySavings"
                            [showAddToPlanColumn]="!showDefaultRecommendation && !showDefaultRentalMeasures"
                    ></app-energy-efficiency-recommendation-larger-improvement-card>
                </div>
                <div *ngIf="tabOpened === 'dismiss'">
                    <app-energy-efficiency-recommendation-quick-win-card
                            *ngFor="let recommendation of getUserRecommendations('quick-wins-dismiss'); let i = index"
                            [stepIndex]="i"
                            [recommendation]="recommendation"
                            [showMonthlySavings]="showMonthlySavings"
                            [showAddToPlanColumn]="!showDefaultRecommendation && !showDefaultRentalMeasures"
                    ></app-energy-efficiency-recommendation-quick-win-card>
                    <app-energy-efficiency-recommendation-larger-improvement-card
                            *ngFor="let recommendation of getUserRecommendations('larger-improvements-dismiss'); let i = index"
                            [stepIndex]="i"
                            [recommendation]="recommendation"
                            [showMonthlySavings]="showMonthlySavings"
                            [showAddToPlanColumn]="!showDefaultRecommendation && !showDefaultRentalMeasures"
                    ></app-energy-efficiency-recommendation-larger-improvement-card>
                </div>
                <app-energy-efficiency-combined-recommendation-card
                        *ngIf="shouldShowLandlordRecommendation() && getLandlordRecommendations('').length"
                        [combinedHeadline]="combinedLandlordRecommendationHeadline"
                        [combinedSummary]="'Since you are renting, some of our recommendations will need to be carried out by your landlord.'"
                        [combinedIconPath]="'icons/home-improve.svg'"
                        [recommendations]="getLandlordRecommendations('')"
                        [showMonthlySavings]="showMonthlySavings"
                        [showAddToPlanColumn]="!showDefaultRecommendation && !showDefaultRentalMeasures"
                ></app-energy-efficiency-combined-recommendation-card>
            </div>
            <div class="recommendation-cards" *ngIf="showOldVersion">
                <app-energy-efficiency-recommendation-card
                        *ngFor="let recommendation of getUserRecommendations('')"
                        [recommendation]="recommendation"
                        [showMonthlySavings]="showMonthlySavings"
                        [showAddToPlanColumn]="!showDefaultRecommendation && !showDefaultRentalMeasures"
                ></app-energy-efficiency-recommendation-card>
                <app-energy-efficiency-combined-recommendation-card
                        *ngIf="shouldShowLandlordRecommendation() && getLandlordRecommendations('').length"
                        [combinedHeadline]="combinedLandlordRecommendationHeadline"
                        [combinedSummary]="'Since you are renting, some of our recommendations will need to be carried out by your landlord.'"
                        [combinedIconPath]="'icons/home-improve.svg'"
                        [recommendations]="getLandlordRecommendations('')"
                        [showMonthlySavings]="showMonthlySavings"
                        [showAddToPlanColumn]="!showDefaultRecommendation && !showDefaultRentalMeasures"
                ></app-energy-efficiency-combined-recommendation-card>
            </div>
        </div>
    </div>
    <div class="sticky-row-container" *ngIf="!showOldVersion">
        <app-sticky-row-wrapper>
            <app-download-plan></app-download-plan>
        </app-sticky-row-wrapper>
    </div>
    <app-sticky-row-wrapper *ngIf="showOldVersion">
        <app-your-plan-footer
                (onDoPlan)="sendEventToAnalytics('do_clicked')"
        ></app-your-plan-footer>
    </app-sticky-row-wrapper>
</div>
